<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erfolge - Daily Quest System</title>
    <style>
        :root{--p:#4CAF50;--s:#FFC107;--bg:#f5f5f5;--card:#fff;--txt:#333;--border:#ddd}
        [data-theme="dark"]{--p:#66BB6A;--s:#FFD54F;--bg:#121212;--card:#1e1e1e;--txt:#fff;--border:#333}
        [data-theme="minimal"]{--p:#000;--s:#666;--bg:#fff;--card:#fafafa;--txt:#000;--border:#eee}
        [data-theme="ocean"]{--p:#2196F3;--s:#00BCD4;--bg:#E3F2FD;--card:#fff;--txt:#0D47A1;--border:#BBDEFB}
        [data-theme="forest"]{--p:#388E3C;--s:#8BC34A;--bg:#E8F5E8;--card:#fff;--txt:#1B5E20;--border:#C8E6C9}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui;background:var(--bg);color:var(--txt);line-height:1.6;transition:all .3s;padding:2rem;max-width:1200px;margin:0 auto}
        .n{text-align:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
        .n a{color:var(--txt);text-decoration:none;margin:0 1rem;font-size:.9rem;opacity:.8;transition:all .3s}
        .n a:hover{color:var(--p);opacity:1}
        .h{text-align:center;margin-bottom:30px;background:var(--card);padding:30px;border-radius:15px;box-shadow:0 4px 6px rgba(0,0,0,.1)}
        .h h1{color:var(--p);margin-bottom:10px;font-size:2.5rem}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
        .stat{background:var(--card);padding:20px;border-radius:10px;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,.1)}
        .stat-n{font-size:2rem;font-weight:bold;color:var(--p)}
        .stat-l{color:#666;margin-top:5px}
        .cats{display:grid;gap:30px}
        .cat{background:var(--card);border-radius:15px;padding:25px;box-shadow:0 4px 6px rgba(0,0,0,.1)}
        .cat-t{font-size:1.5rem;margin-bottom:20px;color:var(--p);display:flex;align-items:center;gap:10px}
        .achs{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px}
        .ach{display:flex;align-items:center;gap:15px;padding:15px;border:2px solid var(--border);border-radius:10px;transition:all .3s;position:relative}
        .ach.u{border-color:#FFD700;background:linear-gradient(135deg,#fff9c4,#fff);transform:scale(1.02)}
        [data-theme="dark"] .ach.u{background:linear-gradient(135deg,#2a2a00,#1a1a00);color:var(--txt)}
        .ach.l{opacity:.6}
        .ach-i{font-size:2.5rem;width:60px;height:60px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:#ccc;transition:all .3s}
        .ach.u .ach-i{background:#FFD700;animation:glow 2s ease-in-out infinite alternate}
        .ach-c{flex:1}
        .ach-n{font-weight:bold;font-size:1.1rem;margin-bottom:5px}
        .ach-d{color:#666;font-size:.9rem;margin-bottom:5px}
        .ach-p{font-size:.8rem;color:var(--p);font-weight:bold}
        .ach-r{position:absolute;top:10px;right:10px;background:var(--s);color:#fff;padding:4px 8px;border-radius:12px;font-size:.7rem;font-weight:bold}
        .pb{width:100%;height:6px;background:#eee;border-radius:3px;margin-top:8px;overflow:hidden}
        .pf{height:100%;background:var(--p);border-radius:3px;transition:width .3s}
        @keyframes glow{from{box-shadow:0 0 5px #FFD700}to{box-shadow:0 0 20px #FFD700,0 0 30px #FFD700}}
        @keyframes unlock{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
        .ach.ju{animation:unlock .6s ease-in-out}
        @media(max-width:768px){.achs{grid-template-columns:1fr}.stats{grid-template-columns:repeat(2,1fr)};body{padding:1rem}}
    </style>
</head>
<body>
    <nav class="n">
        <a href="daily-quests.html">üéØ T√§gliche Quests</a>
        <a href="calendar.html">üìÖ Kalender</a>
        <a href="analytics.html">üìä Statistiken</a>
        <a href="quest-shop.html">üõí Shop</a>
    </nav>

    <nav class="n">
        <a href="settings.html">‚öôÔ∏è Einstellungen</a>
        <a href="../../index.html">üè† Startseite</a>
    </nav>

    <div class="h">
        <h1>üèÜ Erfolge</h1>
        <p>Deine Meilensteine und Auszeichnungen</p>
    </div>
    <div class="stats">
        <div class="stat"><div class="stat-n" id="total">0</div><div class="stat-l">Erfolge freigeschaltet</div></div>
        <div class="stat"><div class="stat-n" id="points">0</div><div class="stat-l">Erfolgspunkte</div></div>
        <div class="stat"><div class="stat-n" id="rate">0%</div><div class="stat-l">Fortschritt</div></div>
        <div class="stat"><div class="stat-n" id="rare">0</div><div class="stat-l">Seltene Erfolge</div></div>
    </div>
    <div class="cats" id="cats"></div>
    <script>
        const defs={
            basic:{title:'üåü Grundlagen',achs:[
                {id:'first_steps',name:'Erste Schritte',desc:'Schlie√üe deine erste Quest ab',icon:'üéØ',req:{type:'quests_completed',value:1},reward:50},
                {id:'getting_started',name:'Aller Anfang ist leicht',desc:'Schlie√üe 5 Quests ab',icon:'üöÄ',req:{type:'quests_completed',value:5},reward:100},
                {id:'level_up',name:'Level Aufstieg',desc:'Erreiche Level 5',icon:'‚¨ÜÔ∏è',req:{type:'level',value:5},reward:150},
                {id:'consistent',name:'Am Ball geblieben',desc:'Erreiche eine 7-Tage-Serie',icon:'üî•',req:{type:'streak',value:7},reward:200}
            ]},
            dedication:{title:'üí™ Dranbleiber',achs:[
                {id:'dedicated',name:'Ehrgeizig',desc:'Erreiche eine 30-Tage-Serie',icon:'üèÉ',req:{type:'streak',value:30},reward:500},
                {id:'legend',name:'Legende',desc:'Erreiche eine 100-Tage-Serie',icon:'üëë',req:{type:'streak',value:100},reward:1000},
                {id:'level_master',name:'Level-Meister',desc:'Erreiche Level 25',icon:'üéñÔ∏è',req:{type:'level',value:25},reward:750},
                {id:'century_club',name:'Club der 100',desc:'Schlie√üe 100 Quests ab',icon:'üíØ',req:{type:'quests_completed',value:100},reward:800}
            ]},
            special:{title:'‚ú® Besondere Leistungen',achs:[
                {id:'perfectionist',name:'Perfektionist',desc:'Schlie√üe alle Quests an einem Tag ab',icon:'‚≠ê',req:{type:'perfect_day',value:1},reward:300},
                {id:'early_bird',name:'Fr√ºher Vogel',desc:'Schlie√üe eine Quest vor 8:00 Uhr ab',icon:'üåÖ',req:{type:'early_completion',value:1},reward:150},
                {id:'night_owl',name:'Nachteule',desc:'Schlie√üe eine Quest nach 22:00 Uhr ab',icon:'ü¶â',req:{type:'late_completion',value:1},reward:150},
                {id:'weekend_warrior',name:'Wochenend-Krieger',desc:'Schlie√üe 10 Quests am Wochenende ab',icon:'üéÆ',req:{type:'weekend_quests',value:10},reward:250}
            ]},
            rare:{title:'üíé Seltene Erfolge',achs:[
                {id:'xp_millionaire',name:'XP-Million√§r',desc:'Sammle 10.000 XP',icon:'üí∞',req:{type:'total_xp',value:10000},reward:1500},
                {id:'quest_master',name:'Quest-Meister',desc:'Erstelle 20 eigene Quests',icon:'üé®',req:{type:'custom_quests',value:20},reward:1000},
                {id:'comeback_kid',name:'Comeback-Kid',desc:'Starte nach einer Pause von 7+ Tagen neu',icon:'üîÑ',req:{type:'comeback',value:1},reward:400}
            ]}
        };

        class AS{
            constructor(){this.achs=this.load();this.init();}
            load(){const s=localStorage.getItem('achievements');return s?JSON.parse(s):{};}
            save(){localStorage.setItem('achievements',JSON.stringify(this.achs));}
            getStats(){
                const u=JSON.parse(localStorage.getItem('userData')||'{}');
                const c=JSON.parse(localStorage.getItem('customQuests')||'[]');
                const h=JSON.parse(localStorage.getItem('completionHistory')||'[]');
                return{
                    level:u.level||1,totalXP:u.totalXP||0,currentStreak:u.streak||0,questsCompleted:h.length,customQuests:c.length,
                    perfectDays:this.countPerfect(),earlyCompletions:this.countEarly(),lateCompletions:this.countLate(),
                    weekendQuests:this.countWeekend(),comebacks:parseInt(localStorage.getItem('comebacks')||'0')
                };
            }
            countPerfect(){const h=JSON.parse(localStorage.getItem('dailyProgress')||'{}');let p=0;for(const d in h){const day=h[d];if(day.questsCompleted>=day.totalQuests&&day.totalQuests>0)p++;}return p;}
            countEarly(){return JSON.parse(localStorage.getItem('completionHistory')||'[]').filter(c=>new Date(c.timestamp).getHours()<8).length;}
            countLate(){return JSON.parse(localStorage.getItem('completionHistory')||'[]').filter(c=>new Date(c.timestamp).getHours()>=22).length;}
            countWeekend(){return JSON.parse(localStorage.getItem('completionHistory')||'[]').filter(c=>{const d=new Date(c.timestamp).getDay();return d===0||d===6;}).length;}
            checkAll(){
                const stats=this.getStats();let news=[];
                for(const cat in defs){for(const ach of defs[cat].achs){if(!this.achs[ach.id]){if(this.checkReq(ach,stats)){this.unlock(ach);news.push(ach);}}}}
                if(news.length>0)this.showUnlocks(news);
            }
            checkReq(ach,stats){
                const r=ach.req;
                switch(r.type){
                    case'level':return stats.level>=r.value;case'total_xp':return stats.totalXP>=r.value;case'streak':return stats.currentStreak>=r.value;
                    case'quests_completed':return stats.questsCompleted>=r.value;case'custom_quests':return stats.customQuests>=r.value;
                    case'perfect_day':return stats.perfectDays>=r.value;case'early_completion':return stats.earlyCompletions>=r.value;
                    case'late_completion':return stats.lateCompletions>=r.value;case'weekend_quests':return stats.weekendQuests>=r.value;
                    case'comeback':return stats.comebacks>=r.value;default:return false;
                }
            }
            unlock(ach){this.achs[ach.id]={unlockedAt:Date.now(),rewarded:false};this.save();this.awardXP(ach.reward);}
            awardXP(amt){const u=JSON.parse(localStorage.getItem('userData')||'{}');u.totalXP=(u.totalXP||0)+amt;u.level=Math.floor(u.totalXP/1000)+1;localStorage.setItem('userData',JSON.stringify(u));}
            showUnlocks(achs){
                if('Notification'in window&&Notification.permission==='granted'){new Notification('üèÜ Erfolg freigeschaltet!',{body:`Du hast ${achs.length} neue Erfolge freigeschaltet!`,icon:'/favicon.ico'});}
                setTimeout(()=>{achs.forEach(ach=>{const el=document.getElementById(`ach-${ach.id}`);if(el)el.classList.add('ju');});},100);
            }
            getProgress(ach){
                const stats=this.getStats();const r=ach.req;let cur=0;
                switch(r.type){
                    case'level':cur=stats.level;break;case'total_xp':cur=stats.totalXP;break;case'streak':cur=stats.currentStreak;break;
                    case'quests_completed':cur=stats.questsCompleted;break;case'custom_quests':cur=stats.customQuests;break;
                    case'perfect_day':cur=stats.perfectDays;break;case'early_completion':cur=stats.earlyCompletions;break;
                    case'late_completion':cur=stats.lateCompletions;break;case'weekend_quests':cur=stats.weekendQuests;break;
                    case'comeback':cur=stats.comebacks;break;
                }
                return Math.min(cur,r.value);
            }
            render(){
                const cont=document.getElementById('cats');cont.innerHTML='';
                for(const[catKey,cat]of Object.entries(defs)){
                    const catEl=document.createElement('div');catEl.className='cat';
                    catEl.innerHTML=`<h2 class="cat-t">${cat.title}</h2><div class="achs">${cat.achs.map(ach=>this.renderAch(ach)).join('')}</div>`;
                    cont.appendChild(catEl);
                }
            }
            renderAch(ach){
                const isU=this.achs[ach.id];const prog=this.getProgress(ach);const perc=Math.round((prog/ach.req.value)*100);
                return`<div class="ach ${isU?'u':'l'}" id="ach-${ach.id}"><div class="ach-i">${ach.icon}</div><div class="ach-c"><div class="ach-n">${ach.name}</div><div class="ach-d">${ach.desc}</div><div class="ach-p">${isU?'Freigeschaltet!':`${prog}/${ach.req.value} (${perc}%)`}</div>${!isU?`<div class="pb"><div class="pf" style="width:${perc}%"></div></div>`:''}</div><div class="ach-r">+${ach.reward} XP</div></div>`;
            }
            updateStats(){
                const un=Object.keys(this.achs).length;const tot=Object.values(defs).reduce((s,cat)=>s+cat.achs.length,0);
                const pts=Object.values(defs).flat().filter(cat=>cat.achs).reduce((s,cat)=>s+cat.achs.filter(ach=>this.achs[ach.id]).reduce((s2,ach)=>s2+ach.reward,0),0);
                const rare=this.achs['xp_millionaire']||this.achs['quest_master']?1:0;
                document.getElementById('total').textContent=un;document.getElementById('points').textContent=pts;
                document.getElementById('rate').textContent=`${Math.round((un/tot)*100)}%`;document.getElementById('rare').textContent=rare;
            }
            init(){this.checkAll();this.render();this.updateStats();}
        }

        function applyTheme(){const s=JSON.parse(localStorage.getItem('questSettings')||'{}');if(s.theme)document.documentElement.setAttribute('data-theme',s.theme);}

        document.addEventListener('DOMContentLoaded',()=>{applyTheme();window.achievementSystem=new AS();});
        window.checkAchievements=function(){if(window.achievementSystem){window.achievementSystem.checkAll();}};
    </script>
</body>
</html>