<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Einstellungen - Daily Quest</title>
    <style>
        :root { --p: #4CAF50; --s: #FFC107; --bg: #f5f5f5; --card: #fff; --txt: #333; --border: #ddd; }
        [data-theme="dark"] { --p: #66BB6A; --s: #FFD54F; --bg: #121212; --card: #1e1e1e; --txt: #fff; --border: #333; }
        [data-theme="minimal"] { --p: #000; --s: #666; --bg: #fff; --card: #fafafa; --txt: #000; --border: #eee; }
        [data-theme="ocean"] { --p: #2196F3; --s: #00BCD4; --bg: #E3F2FD; --card: #fff; --txt: #0D47A1; --border: #BBDEFB; }
        [data-theme="forest"] { --p: #388E3C; --s: #8BC34A; --bg: #E8F5E8; --card: #fff; --txt: #1B5E20; --border: #C8E6C9; }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background: var(--bg); color: var(--txt); line-height: 1.6; transition: background 0.3s, color 0.3s; padding: 2rem; max-width: 900px; margin: 0 auto; }
        .nav { text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); }
        .nav a { color: var(--txt); text-decoration: none; margin: 0 1rem; font-size: 1rem; opacity: .8; transition: all .3s; }
        .nav a:hover { color: var(--p); opacity: 1; }

        .header { text-align: center; margin-bottom: 3rem; }
        .header h1 { color: var(--p); margin-bottom: 0.5rem; font-size: 2.8rem; }
        .header p { font-size: 1.1rem; opacity: 0.8; }

        .section { background: var(--card); border-radius: 15px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 6px 12px rgba(0,0,0,0.08); }
        .section-title { font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--p); display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid var(--border); padding-bottom: 0.75rem; }

        .theme-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; }
        .theme-option { border: 2px solid var(--border); border-radius: 10px; padding: 1rem; cursor: pointer; transition: all .3s; text-align: center; }
        .theme-option:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .theme-option.active { border-color: var(--p); background: var(--p); color: var(--card); }
        .theme-preview { width: 100%; height: 50px; border-radius: 8px; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; }
        .theme-name { font-weight: bold; }

        .settings-grid { display: grid; gap: 1.5rem; }
        .setting { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border); border-radius: 8px; transition: background .3s; }
        .setting:hover { background: var(--bg); }
        .setting-info h3 { margin-bottom: 0.25rem; color: var(--txt); }
        .setting-info p { font-size: 0.9rem; opacity: .7; }
        
        .switch { position: relative; width: 50px; height: 26px; background: var(--border); border-radius: 13px; cursor: pointer; transition: background .3s; }
        .switch.active { background: var(--p); }
        .switch-handle { position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform .3s; }
        .switch.active .switch-handle { transform: translateX(24px); }

        .btn { background: var(--s); color: #fff; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all .3s; }
        .btn:hover { opacity: .85; }

        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 1rem 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; opacity: 0; transition: opacity .3s, transform .3s; }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        @media (max-width: 768px) { body { padding: 1rem; } .header h1 { font-size: 2.2rem; } }
    </style>
</head>
<body>
    <nav class="nav">
        <a href="daily-quests.html">TÃ¤gliche Quests</a>
        <a href="achievements.html">Erfolge</a>
        <a href="calendar.html">Kalender</a>
        <a href="quest-shop.html">Shop</a>
    </nav>

    <div class="header">
        <h1>Einstellungen</h1>
        <p>Passe deine Daily Quest-Erfahrung an.</p>
    </div>

    <div class="section">
        <h2 class="section-title">ðŸŽ¨ Erscheinungsbild</h2>
        <div class="theme-grid" id="theme-grid"></div>
    </div>

    <div class="section">
        <h2 class="section-title">ðŸ”” Benachrichtigungen</h2>
        <div class="settings-grid">
            <div class="setting">
                <div class="setting-info">
                    <h3>Erfolgs-Benachrichtigungen</h3>
                    <p>Erhalte eine Meldung bei neuen Erfolgen.</p>
                </div>
                <div class="switch" data-setting="achievementNotifications"></div>
            </div>
            <div class="setting">
                <div class="setting-info">
                    <h3>TÃ¤gliche Erinnerungen</h3>
                    <p>Erinnert dich abends an offene Quests.</p>
                </div>
                <div class="switch" data-setting="dailyReminders"></div>
            </div>
            <div class="setting">
                <div class="setting-info">
                    <h3>Streak-Warnungen</h3>
                    <p>Warnt dich, bevor deine Serie endet.</p>
                </div>
                <div class="switch" data-setting="streakWarnings"></div>
            </div>
            <div class="setting">
                <div class="setting-info">
                    <h3>Sound-Effekte</h3>
                    <p>Spielt Sounds bei wichtigen Aktionen.</p>
                </div>
                <div class="switch" data-setting="celebrationSounds"></div>
            </div>
            <div class="setting">
                <div class="setting-info">
                    <h3>Test-Benachrichtigung</h3>
                    <p>PrÃ¼fe, ob Benachrichtigungen funktionieren.</p>
                </div>
                <button class="btn" onclick="testNotification()">Testen</button>
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">ðŸ’¾ Datenverwaltung</h2>
        <div class="settings-grid">
            <div class="setting">
                <div class="setting-info">
                    <h3>Daten exportieren</h3>
                    <p>Sichere deine gesamten Quest-Daten als JSON-Datei.</p>
                </div>
                <button class="btn" onclick="exportData()">Exportieren</button>
            </div>
            <div class="setting">
                <div class="setting-info">
                    <h3>Daten importieren</h3>
                    <p>Lade eine zuvor gesicherte JSON-Datei hoch.</p>
                </div>
                <input type="file" id="import-file" style="display: none;" accept=".json">
                <button class="btn" onclick="document.getElementById('import-file').click()">Importieren</button>
            </div>
            <div class="setting">
                <div class="setting-info">
                    <h3>App zurÃ¼cksetzen</h3>
                    <p><strong>Achtung:</strong> LÃ¶scht alle deine Daten unwiderruflich.</p>
                </div>
                <button class="btn" style="background: #f44336;" onclick="resetApp()">ZurÃ¼cksetzen</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        const settingsManager = {
            defaults: {
                theme: 'light',
                achievementNotifications: true,
                dailyReminders: true,
                streakWarnings: true,
                celebrationSounds: true
            },
            settings: {},
            themes: [
                { id: 'light', name: 'Standard', colors: ['#4CAF50', '#FFC107'] },
                { id: 'dark', name: 'Dark Mode', colors: ['#66BB6A', '#FFD54F'] },
                { id: 'minimal', name: 'Minimal', colors: ['#000', '#666'] },
                { id: 'ocean', name: 'Ozean', colors: ['#2196F3', '#00BCD4'] },
                { id: 'forest', name: 'Wald', colors: ['#388E3C', '#8BC34A'] }
            ],

            init() {
                this.settings = this.loadSettings();
                this.applyTheme();
                this.renderThemes();
                this.initSwitches();
                this.initEventListeners();
            },

            loadSettings() {
                const saved = localStorage.getItem('questSettings');
                return saved ? { ...this.defaults, ...JSON.parse(saved) } : this.defaults;
            },

            saveSettings() {
                localStorage.setItem('questSettings', JSON.stringify(this.settings));
                this.showToast('Einstellungen gespeichert!');
            },

            applyTheme() {
                document.documentElement.setAttribute('data-theme', this.settings.theme);
            },

            renderThemes() {
                const grid = document.getElementById('theme-grid');
                grid.innerHTML = this.themes.map(theme => `
                    <div class="theme-option ${this.settings.theme === theme.id ? 'active' : ''}" data-theme="${theme.id}">
                        <div class="theme-preview" style="background: linear-gradient(135deg, ${theme.colors[0]}, ${theme.colors[1]})">${theme.name}</div>
                    </div>
                `).join('');
            },

            initSwitches() {
                document.querySelectorAll('.switch').forEach(sw => {
                    const key = sw.dataset.setting;
                    if (this.settings[key]) {
                        sw.classList.add('active');
                    }
                    sw.innerHTML = '<div class="switch-handle"></div>';
                });
            },

            initEventListeners() {
                document.getElementById('theme-grid').addEventListener('click', e => {
                    const themeOption = e.target.closest('.theme-option');
                    if (themeOption) {
                        this.settings.theme = themeOption.dataset.theme;
                        this.applyTheme();
                        this.renderThemes();
                        this.saveSettings();
                    }
                });

                document.querySelectorAll('.switch').forEach(sw => {
                    sw.addEventListener('click', () => {
                        const key = sw.dataset.setting;
                        this.settings[key] = !this.settings[key];
                        sw.classList.toggle('active');
                        this.saveSettings();
                    });
                });

                document.getElementById('import-file').addEventListener('change', this.importData.bind(this));
            },

            showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            },

            exportData() {
                const data = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    data[key] = localStorage.getItem(key);
                }
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `daily-quest-sicherung-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(a.href);
                this.showToast('Daten exportiert!');
            },

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (confirm('MÃ¶chtest du wirklich alle aktuellen Daten mit dem Inhalt dieser Datei Ã¼berschreiben?')) {
                            Object.keys(data).forEach(key => {
                                localStorage.setItem(key, data[key]);
                            });
                            this.showToast('Daten erfolgreich importiert! Die Seite wird neu geladen.');
                            setTimeout(() => window.location.reload(), 2000);
                        }
                    } catch (err) {
                        this.showToast('Fehler: Die Importdatei ist ungÃ¼ltig.', 'error');
                        console.error(err);
                    }
                };
                reader.readAsText(file);
            },

            resetApp() {
                if (confirm('Bist du absolut sicher? Alle deine Quests, Erfolge und Einstellungen werden gelÃ¶scht. Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.')) {
                    localStorage.clear();
                    this.showToast('Alle Daten wurden zurÃ¼ckgesetzt. Die Seite wird neu geladen.');
                    setTimeout(() => window.location.reload(), 2000);
                }
            },

            testNotification() {
                if (!('Notification' in window)) {
                    this.showToast('Browser unterstÃ¼tzt keine Benachrichtigungen.');
                    return;
                }
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('ðŸ§ª Test-Benachrichtigung', {
                            body: 'Wenn du das siehst, funktioniert alles super!',
                            icon: 'https://cdn-icons-png.flaticon.com/512/148/148767.png'
                        });
                    } else {
                        this.showToast('Benachrichtigungen wurden blockiert.');
                    }
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => settingsManager.init());

        window.exportData = () => settingsManager.exportData();
        window.importData = () => settingsManager.importData();
        window.resetApp = () => settingsManager.resetApp();
        window.testNotification = () => settingsManager.testNotification();

    </script>
</body>
</html>