<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Einstellungen - Daily Quest System</title>
    <style>
        :root{--p:#4CAF50;--s:#FFC107;--bg:#f5f5f5;--card:#fff;--txt:#333;--border:#ddd}
        [data-theme="dark"]{--p:#66BB6A;--s:#FFD54F;--bg:#121212;--card:#1e1e1e;--txt:#fff;--border:#333}
        [data-theme="minimal"]{--p:#000;--s:#666;--bg:#fff;--card:#fafafa;--txt:#000;--border:#eee}
        [data-theme="ocean"]{--p:#2196F3;--s:#00BCD4;--bg:#E3F2FD;--card:#fff;--txt:#0D47A1;--border:#BBDEFB}
        [data-theme="forest"]{--p:#388E3C;--s:#8BC34A;--bg:#E8F5E8;--card:#fff;--txt:#1B5E20;--border:#C8E6C9}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--txt);line-height:1.6;transition:all .3s;padding:2rem;max-width:800px;margin:0 auto}
        .n{text-align:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
        .n a{color:var(--txt);text-decoration:none;margin:0 1rem;font-size:.9rem;opacity:.8;transition:all .3s}
        .n a:hover{color:var(--p);opacity:1}
        .h{text-align:center;margin-bottom:30px;background:var(--card);padding:30px;border-radius:15px;box-shadow:0 4px 6px rgba(0,0,0,.1)}
        .h h1{color:var(--p);margin-bottom:10px;font-size:2.5rem}
        .sec{background:var(--card);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 6px rgba(0,0,0,.1)}
        .sec-t{font-size:1.3rem;margin-bottom:20px;color:var(--p);display:flex;align-items:center;gap:10px}
        .theme-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}
        .theme{border:2px solid var(--border);border-radius:10px;padding:15px;cursor:pointer;transition:all .3s;text-align:center}
        .theme:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}
        .theme.active{border-color:var(--p);background:linear-gradient(135deg,var(--p),var(--s));color:#fff}
        .theme-prev{width:100%;height:60px;border-radius:8px;margin-bottom:10px;display:flex;align-items:center;justify-content:center;font-weight:bold}
        .theme-name{font-weight:bold;margin-bottom:5px}
        .theme-desc{font-size:.85rem;opacity:.8}
        .notif{display:grid;gap:15px}
        .set{display:flex;justify-content:space-between;align-items:center;padding:15px;border:1px solid var(--border);border-radius:8px}
        .set-info h3{margin-bottom:5px;color:var(--txt)}
        .set-info p{font-size:.9rem;opacity:.8}
        .switch{position:relative;width:50px;height:24px;background:var(--border);border-radius:12px;cursor:pointer;transition:all .3s}
        .switch.active{background:var(--p)}
        .switch-handle{position:absolute;top:2px;left:2px;width:20px;height:20px;background:#fff;border-radius:50%;transition:all .3s}
        .switch.active .switch-handle{left:28px}
        .test{background:var(--s);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:.9rem;transition:all .3s}
        .test:hover{opacity:.8}
        @media(max-width:768px){.theme-grid{grid-template-columns:1fr};body{padding:1rem}}
    </style>
</head>
<body>
    <nav class="n">
        <a href="daily-quests.html">üéØ Daily Quests</a>
        <a href="achievements.html">üèÜ Achievements</a>
        <a href="calendar.html">üìÖ Calendar</a>
        <a href="analytics.html">üìä Analytics</a>
        <a href="quest-shop.html">üõí Shop</a>
        <a href="settings.html">‚öôÔ∏è Settings</a>
        <a href="index.html">Home</a>
    </nav>
    <div class="h">
        <h1>‚öôÔ∏è Einstellungen</h1>
        <p>Personalisiere deine Quest-Erfahrung</p>
    </div>
    <div class="sec">
        <h2 class="sec-t">üé® Themes</h2>
        <div class="theme-grid">
            <div class="theme" data-theme="light">
                <div class="theme-prev" style="background:linear-gradient(135deg,#4CAF50,#FFC107)">Light</div>
                <div class="theme-name">Standard</div>
                <div class="theme-desc">Helles, freundliches Design</div>
            </div>
            <div class="theme" data-theme="dark">
                <div class="theme-prev" style="background:linear-gradient(135deg,#66BB6A,#FFD54F);color:#fff">Dark</div>
                <div class="theme-name">Dark Mode</div>
                <div class="theme-desc">Augenschonend und elegant</div>
            </div>
                <div class="theme" data-theme="minimal">
                    <div class="theme-prev" style="background:linear-gradient(135deg,#000,#666);color:#fff">Minimal</div>
                    <div class="theme-name">Minimal</div>
                    <div class="theme-desc">Reduziert und fokussiert</div>
                </div>
                <div class="theme" data-theme="ocean">
                    <div class="theme-prev" style="background:linear-gradient(135deg,#2196F3,#00BCD4);color:#fff">Ocean</div>
                    <div class="theme-name">Ocean</div>
                    <div class="theme-desc">Beruhigend wie das Meer</div>
                </div>
                <div class="theme" data-theme="forest">
                    <div class="theme-prev" style="background:linear-gradient(135deg,#388E3C,#8BC34A);color:#fff">Forest</div>
                    <div class="theme-name">Forest</div>
                    <div class="theme-desc">Nat√ºrlich und entspannend</div>
                </div>
            </div>
        </div>
        <div class="sec">
            <h2 class="sec-t">üîî Benachrichtigungen</h2>
            <div class="notif">
                <div class="set">
                    <div class="set-info">
                        <h3>Achievement Benachrichtigungen</h3>
                        <p>Zeige Benachrichtigungen wenn neue Erfolge freigeschaltet werden</p>
                    </div>
                    <div class="switch" id="achievementNotifications">
                        <div class="switch-handle"></div>
                    </div>
                </div>
                <div class="set">
                    <div class="set-info">
                        <h3>T√§gliche Erinnerungen</h3>
                        <p>Erinnere mich daran, meine t√§glichen Quests zu erledigen</p>
                    </div>
                    <div class="switch" id="dailyReminders">
                        <div class="switch-handle"></div>
                    </div>
                </div>
                <div class="set">
                    <div class="set-info">
                        <h3>Streak Warnungen</h3>
                        <p>Warne mich, wenn meine Streak in Gefahr ist</p>
                    </div>
                    <div class="switch" id="streakWarnings">
                        <div class="switch-handle"></div>
                    </div>
                </div>
                <div class="set">
                    <div class="set-info">
                        <h3>Celebration Sounds</h3>
                        <p>Spiele Sounds bei Quest-Abschluss und Level-Ups</p>
                    </div>
                    <div class="switch" id="celebrationSounds">
                        <div class="switch-handle"></div>
                    </div>
                </div>
                <div class="set">
                    <div class="set-info">
                        <h3>Test Benachrichtigung</h3>
                        <p>Teste ob Browser-Benachrichtigungen funktionieren</p>
                    </div>
                    <button class="test" onclick="testNotif()">Test senden</button>
                </div>
            </div>
        </div>
        <a href="daily-quests.html" class="nav">üéØ Zur√ºck zu Quests</a>
    </div>
    <script>
        class SM{
            constructor(){
                this.settings=this.load();
                this.init();
            }
            load(){
                const def={theme:'light',achievementNotifications:true,dailyReminders:true,streakWarnings:true,celebrationSounds:true};
                const saved=localStorage.getItem('questSettings');
                return saved?{...def,...JSON.parse(saved)}:def;
            }
            save(){localStorage.setItem('questSettings',JSON.stringify(this.settings));}
            init(){
                this.applyTheme();
                this.setupThemes();
                this.setupNotifs();
                this.reqNotifPerm();
            }
            applyTheme(){
                document.documentElement.setAttribute('data-theme',this.settings.theme);
                document.querySelectorAll('.theme').forEach(opt=>{
                    opt.classList.remove('active');
                    if(opt.dataset.theme===this.settings.theme){
                        opt.classList.add('active');
                    }
                });
            }
            setupThemes(){
                document.querySelectorAll('.theme').forEach(opt=>{
                    opt.addEventListener('click',()=>{
                        this.settings.theme=opt.dataset.theme;
                        this.save();
                        this.applyTheme();
                        this.broadcast();
                    });
                });
            }
            broadcast(){
                window.dispatchEvent(new CustomEvent('themeChanged',{detail:{theme:this.settings.theme}}));
            }
            setupNotifs(){
                const switches=['achievementNotifications','dailyReminders','streakWarnings','celebrationSounds'];
                switches.forEach(key=>{
                    const sw=document.getElementById(key);
                    if(sw){
                        if(this.settings[key])sw.classList.add('active');
                        sw.addEventListener('click',()=>{
                            this.settings[key]=!this.settings[key];
                            sw.classList.toggle('active');
                            this.save();
                        });
                    }
                });
            }
            reqNotifPerm(){
                if('Notification'in window&&Notification.permission==='default'){
                    Notification.requestPermission().then(perm=>{
                        if(perm==='granted'){
                            this.showNotif('üéâ Benachrichtigungen aktiviert!','Du erh√§ltst jetzt Notifications f√ºr Achievements und Erinnerungen.');
                        }
                    });
                }
            }
            showNotif(title,body,opts={}){
                if('Notification'in window&&Notification.permission==='granted'){
                    const notif=new Notification(title,{body:body,icon:'/favicon.ico',badge:'/favicon.ico',...opts});
                    notif.onclick=()=>{window.focus();notif.close();};
                    setTimeout(()=>notif.close(),5000);
                }
            }
            playSound(){
                if(!this.settings.celebrationSounds)return;
                try{
                    const ctx=new(window.AudioContext||window.webkitAudioContext)();
                    const osc=ctx.createOscillator();
                    const gain=ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.setValueAtTime(800,ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(1200,ctx.currentTime+0.1);
                    gain.gain.setValueAtTime(0.3,ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.3);
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime+0.3);
                }catch(e){console.log('Audio not supported');}
            }
            scheduleReminders(){
                if(!this.settings.dailyReminders)return;
                const now=new Date();
                const rem=new Date();
                rem.setHours(20,0,0,0);
                if(rem<=now)rem.setDate(rem.getDate()+1);
                const time=rem.getTime()-now.getTime();
                setTimeout(()=>{
                    const today=new Date().toDateString();
                    const last=localStorage.getItem('bq-last');
                    if(last!==today){
                        this.showNotif('üéØ T√§gliche Quest Erinnerung','Vergiss nicht deine t√§glichen Quests zu erledigen!');
                    }
                    this.scheduleReminders();
                },time);
            }
        }

        function testNotif(){
            if(window.sm){
                window.sm.showNotif('üß™ Test Benachrichtigung','Benachrichtigungen funktionieren perfekt!');
            }
        }

        function applyTheme(){
            const s=JSON.parse(localStorage.getItem('questSettings')||'{}');
            if(s.theme)document.documentElement.setAttribute('data-theme',s.theme);
        }

        document.addEventListener('DOMContentLoaded',()=>{
            applyTheme();
            window.sm=new SM();
            window.sm.scheduleReminders();
        });

        window.questSettings={
            getSettings:()=>window.sm?.settings||{},
            showNotification:(title,body,opts)=>window.sm?.showNotif(title,body,opts),
            playCelebrationSound:()=>window.sm?.playSound(),
            applyTheme:applyTheme
        };
    </script>
</body>
</html>