<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiken - Daily Quest</title>
    <style>
        :root{--p:#66BB6A;--s:#FFD54F;--bg:#121212;--card:#1e1e1e;--txt:#fff;--border:#333}
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:var(--bg);color:var(--txt);font-family:Georgia,serif;padding:2rem;max-width:1200px;margin:0 auto;line-height:1.6}
        .h{text-align:center;margin-bottom:3rem}.t{font-size:2.5rem;margin-bottom:.5rem;color:var(--p)}.st{opacity:.8;font-style:italic}
        .n{text-align:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
        .n a{color:var(--txt);text-decoration:none;margin:0 1rem;font-size:.9rem;opacity:.8;transition:all .3s}
        .n a:hover{color:var(--p);opacity:1}
        .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem;margin-bottom:3rem}
        .c{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:1.5rem}
        .ct{font-size:1.2rem;margin-bottom:1rem;color:var(--p);display:flex;align-items:center;gap:.5rem}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:1rem;margin-bottom:1rem}
        .stat{text-align:center;padding:1rem;background:var(--bg);border-radius:8px}
        .sv{font-size:1.5rem;font-weight:bold;color:var(--p);margin-bottom:.3rem}
        .sl{font-size:.8rem;opacity:.8}
        .chart{height:200px;position:relative;background:var(--bg);border-radius:8px;padding:1rem;margin-bottom:1rem}
        .heatmap{display:grid;grid-template-columns:repeat(24,1fr);gap:2px;height:150px}
        .hh{grid-column:span 24;display:grid;grid-template-columns:repeat(24,1fr);gap:2px;height:20px;margin-bottom:5px}
        .hc{border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:.6rem;cursor:pointer}
        .patterns{display:grid;grid-template-columns:repeat(7,1fr);gap:1rem;margin-bottom:1rem}
        .pd{text-align:center;padding:.8rem;background:var(--bg);border-radius:8px;font-size:.8rem}
        .pv{font-weight:bold;color:var(--p);margin-bottom:.3rem}
        .insights{margin-bottom:2rem}
        .insight{margin-bottom:1rem;padding:1rem;background:var(--bg);border-radius:8px;border-left:4px solid var(--p)}
        .it{font-weight:bold;margin-bottom:.5rem;color:var(--p)}
        .ix{font-size:.9rem;opacity:.8}
        .export{text-align:center;margin-top:2rem}
        .eb{background:var(--p);color:var(--card);border:none;padding:.8rem 1.5rem;border-radius:6px;cursor:pointer;margin:0 .5rem;font-size:.9rem;transition:all .3s}
        .eb:hover{background:var(--s)}
        .trend{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}
        .tl{font-size:.9rem;opacity:.8}
        .tv{font-size:1.2rem;font-weight:bold;color:var(--p)}
        .progress{background:var(--border);height:8px;border-radius:4px;overflow:hidden;margin-top:.5rem}
        .pf{background:var(--p);height:100%;transition:width .3s}
        @media(max-width:768px){body{padding:1rem}.grid{grid-template-columns:1fr}.stats{grid-template-columns:repeat(2,1fr)}.patterns{grid-template-columns:repeat(3,1fr)}}
    </style>
</head>
<body>
    <nav class="n">
        <a href="daily-quests.html">T√§gliche Quests</a>
        <a href="achievements.html">Erfolge</a>
        <a href="calendar.html">Kalender</a>
        <a href="quest-shop.html">Shop</a>
        <a href="settings.html">Einstellungen</a>
    </nav>

    <header class="h">
        <h1 class="t">Statistik-Dashboard</h1>
        <p class="st">Einblicke in deine Produktivit√§tsreise</p>
    </header>
    <div class="grid">
        <div class="c">
            <h3 class="ct">üìà Leistungs√ºbersicht</h3>
            <div class="stats">
                <div class="stat"><div class="sv" id="ts">0</div><div class="sl">Gesamt-Streak</div></div>
                <div class="stat"><div class="sv" id="cs">0</div><div class="sl">Aktuelle Serie</div></div>
                <div class="stat"><div class="sv" id="tx">0</div><div class="sl">Gesamt-XP</div></div>
                <div class="stat"><div class="sv" id="ax">0</div><div class="sl">Durchschnitts-XP/Tag</div></div>
                <div class="stat"><div class="sv" id="cr">0%</div><div class="sl">Abschlussrate</div></div>
                <div class="stat"><div class="sv" id="pd">0</div><div class="sl">Perfekte Tage</div></div>
            </div>
        </div>
        <div class="c">
            <h3 class="ct">üïê St√ºndliche Aktivit√§t</h3>
            <div class="chart">
                <div class="heatmap" id="hm"></div>
            </div>
        </div>
    </div>
    <div class="grid">
        <div class="c">
            <h3 class="ct">üìÖ Wochentagsmuster</h3>
            <div class="patterns" id="wp"></div>
        </div>
        <div class="c">
            <h3 class="ct">üìä Aktuelle Trends</h3>
            <div id="trends"></div>
        </div>
    </div>
    <div class="c insights">
        <h3 class="ct">üí° Einblicke & Empfehlungen</h3>
        <div id="il"></div>
    </div>
    <div class="export">
        <h3 class="ct">üìÅ Daten exportieren</h3>
        <button class="eb" onclick="ex('json')">JSON exportieren</button>
        <button class="eb" onclick="ex('csv')">CSV exportieren</button>
        <button class="eb" onclick="ex('md')">Markdown exportieren</button>
    </div>
    <script>
        let ad={};
        function ld(){
            const dp=JSON.parse(localStorage.getItem('dailyProgress')||'{}'),ch=JSON.parse(localStorage.getItem('completionHistory')||'[]'),u=JSON.parse(localStorage.getItem('userData')||'{}');
            ad={dailyProgress:dp,completionHistory:ch,userData:u};
        }
        function cs(){
            const dp=ad.dailyProgress;let ts=0,cs=0,ct=0;
            const ds=Object.keys(dp).sort().reverse();
            for(const d of ds){
                const data=dp[d];
                if(data.questsCompleted>=data.totalQuests){ts++;if(ct===0)cs++;}else{if(ct===0)break;}ct++;
            }
            return{totalStreak:ts,currentStreak:cs};
        }
        function ca(){
            const dp=ad.dailyProgress;let tx=0,td=0,pd=0,cr=0;
            Object.values(dp).forEach(d=>{tx+=d.xpEarned||0;td++;if(d.questsCompleted>=d.totalQuests)pd++;cr+=(d.questsCompleted/d.totalQuests);});
            return{totalXP:tx,totalDays:td,perfectDays:pd,avgXP:td>0?Math.round(tx/td):0,completionRate:td>0?Math.round((cr/td)*100):0};
        }
        function us(){
            const{totalStreak:ts,currentStreak:cs}=cs(),{totalXP:tx,avgXP:ax,completionRate:cr,perfectDays:pd}=ca();
            document.getElementById('ts').textContent=ts;document.getElementById('cs').textContent=cs;
            document.getElementById('tx').textContent=tx;document.getElementById('ax').textContent=ax;
            document.getElementById('cr').textContent=cr+'%';document.getElementById('pd').textContent=pd;
        }
        function gh(){
            const hm=document.getElementById('hm');hm.innerHTML='';
            const ha=Array(24).fill(0);
            ad.completionHistory.forEach(c=>{const h=new Date(c.timestamp).getHours();ha[h]++;});
            const mh=Math.max(...ha,1);
            for(let h=0;h<24;h++){
                const c=document.createElement('div');c.className='hc';
                const i=ha[h]/mh;c.style.background=i>0?`rgba(102,187,106,${.2+i*.8})`:'var(--border)';
                c.textContent=h;c.title=`${h}:00 - ${ha[h]} Abschl√ºsse`;hm.appendChild(c);
            }
        }
        function gw(){
            const wp=document.getElementById('wp');wp.innerHTML='';
            const dns=['So','Mo','Di','Mi','Do','Fr','Sa'];const wa=Array(7).fill().map(()=>({total:0,completed:0}));
            Object.entries(ad.dailyProgress).forEach(([date,data])=>{const dow=new Date(date).getDay();wa[dow].total+=data.totalQuests;wa[dow].completed+=data.questsCompleted;});
            wa.forEach((w,i)=>{
                const el=document.createElement('div');el.className='pd';
                const r=w.total>0?Math.round((w.completed/w.total)*100):0;
                el.innerHTML=`<div class="pv">${r}%</div><div>${dns[i]}</div>`;wp.appendChild(el);
            });
        }
        function gt(){
            const tc=document.getElementById('trends');tc.innerHTML='';
            const ld=Object.entries(ad.dailyProgress).sort(([a],[b])=>new Date(b)-new Date(a)).slice(0,7);
            const px=ld.reduce((s,([,d])=>s+(d.xpEarned||0),0));const ax=Math.round(px/7);
            const cr=ld.reduce((s,[,d])=>s+(d.questsCompleted/d.totalQuests),0)/7*100;
            tc.innerHTML=`<div class="trend"><span class="tl">7-Tage Durchschn. XP</span><span class="tv">${ax}</span></div><div class="progress"><div class="pf" style="width:${Math.min(ax/50*100,100)}%"></div></div><div class="trend"><span class="tl">7-Tage Abschlussrate</span><span class="tv">${Math.round(cr)}%</span></div><div class="progress"><div class="pf" style="width:${cr}%"></div></div>`;
        }
        function gi(){
            const ic=document.getElementById('il');ic.innerHTML='';
            const ins=ai();ins.forEach(i=>{
                const el=document.createElement('div');el.className='insight';
                el.innerHTML=`<div class="it">${i.title}</div><div class="ix">${i.text}</div>`;ic.appendChild(el);
            });
        }
        function ai(){
            const{completionRate:cr,perfectDays:pd}=ca();
            const ins=[];
            if(cr>=80)ins.push({title:"üéØ Ausgezeichnete Leistung",text:"Du zeigst eine beeindruckende Konstanz! Mach weiter so."});
            else if(cr>=60)ins.push({title:"üìà Guter Fortschritt",text:"Du bist auf einem guten Weg. Versuche, noch konstanter zu sein, um bessere Ergebnisse zu erzielen."});
            else ins.push({title:"üí™ Raum f√ºr Verbesserungen",text:"Konzentriere dich darauf, t√§glich mehr Quests abzuschlie√üen, um bessere Gewohnheiten aufzubauen."});
            if(pd>=10)ins.push({title:"‚≠ê Perfektionist",text:"Du hast viele perfekte Tage erreicht! Dein Engagement zahlt sich aus."});
            const wa=Array(7).fill().map(()=>({total:0,completed:0}));
            Object.entries(ad.dailyProgress).forEach(([d,data])=>{const dow=new Date(d).getDay();wa[dow].total+=data.totalQuests;wa[dow].completed+=data.questsCompleted;});
            let bd=0,br=0;wa.forEach((w,i)=>{
                if(w.total>0){const r=w.completed/w.total;if(r>br){br=r;bd=i;}}
            });
            const dns=['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'];
            if(br>0)ins.push({title:"üìÖ Bester Tag",text:`Dein produktivster Tag ist ${dns[bd]} mit einer Abschlussrate von ${Math.round(br*100)}%.`});
            return ins;
        }
        function ex(f){
            const data={...ad,analytics:ca(),insights:ai()};
            if(f==='json'){dl(JSON.stringify(data,null,2),'statistiken.json','application/json');}
            else if(f==='csv'){let csv='Datum,Abgeschlossene Quests,Gesamtquests,XP Verdient,Abschlussrate\n';Object.entries(ad.dailyProgress).forEach(([d,data])=>{csv+=`${d},${data.questsCompleted},${data.totalQuests},${data.xpEarned||0},${Math.round((data.questsCompleted/data.totalQuests)*100)}%\n`;});dl(csv,'statistiken.csv','text/csv');}
            else if(f==='md'){
                const{totalXP:tx,avgXP:ax,completionRate:cr,perfectDays:pd}=ca();let md=`# Statistik-Bericht\n\n## √úbersicht\n- Gesamt-XP: ${tx}\n- Durchschnitts-XP/Tag: ${ax}\n- Abschlussrate: ${cr}%\n- Perfekte Tage: ${pd}\n\n## Einblicke\n`;ai().forEach(i=>md+=`### ${i.title}\n${i.text}\n\n`);dl(md,'statistiken.md','text/markdown');
            }
        }
        function dl(c,fn,mt){const b=new Blob([c],{type:mt});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=fn;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);}
        function init(){ld();us();gh();gw();gt();gi();}
        init();setInterval(init,300000);
    </script>
</body>
</html>