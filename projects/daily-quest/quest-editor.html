<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erweiterter Quest-Editor</title>
    <style>
        :root{--p:#66BB6A;--s:#FFD54F;--bg:#121212;--card:#1e1e1e;--txt:#fff;--border:#333}
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--txt); font-family: Georgia, serif; padding: 1rem; max-width: 800px; margin: 0 auto; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 2rem; }
        .title { font-size: 2rem; margin-bottom: 0.5rem; color: var(--p); }
        .subtitle { opacity: 0.8; font-style: italic; }
        .nav { text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); }
        .nav a { color: var(--txt); text-decoration: none; margin: 0 1rem; transition: color .3s; }
        .nav a:hover { color: var(--p); }
        .editor { background: var(--card); border: 1px solid var(--border); padding: 1.5rem; margin-bottom: 2rem; border-radius: 10px; }
        .form-row { margin-bottom: 1.5rem; }
        .label { display: block; margin-bottom: 0.5rem; opacity: 0.9; }
        .input, .textarea, .select { width: 100%; background: var(--bg); border: 1px solid var(--border); color: var(--txt); padding: 0.7rem; font-family: inherit; border-radius: 5px; }
        .input:focus, .textarea:focus, .select:focus { outline: none; border-color: var(--p); }
        .textarea { height: 80px; resize: vertical; }
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        .btn { background: transparent; border: 1px solid var(--border); color: var(--txt); padding: 0.7rem 1.2rem; cursor: pointer; font-family: inherit; border-radius: 5px; transition: all .3s; width:100%; }
        .btn:hover { background: var(--p); color: var(--card); }
        .btn.primary { background: var(--p); color: var(--card); }
        .quest-list { margin-bottom: 2rem; }
        .quest-item { background: var(--card); border: 1px solid var(--border); padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; }
        .quest-item-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; }
        .quest-name { font-size: 1.2rem; font-weight: bold; color: var(--p); }
        .quest-xp { background: var(--s); color: var(--bg); padding: 0.2rem 0.6rem; font-size: 0.8rem; border-radius: 10px; }
        .quest-desc { opacity: 0.8; font-size: 0.9rem; margin-bottom: 1rem; }
        .quest-meta { display: flex; flex-direction:column; gap: 0.5rem; font-size: 0.9rem; opacity: 0.7; margin-bottom: 1rem; }
        .quest-actions { display: flex; gap: 0.5rem; }
        .btn-small { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .btn-danger { border-color: #644; color: #faa; }
        .btn-danger:hover { background: #422; }
        .empty { text-align: center; opacity: 0.6; padding: 2rem; }
        .defaults { margin-bottom: 2rem; }
        .default-quest { background: var(--bg); border: 1px solid var(--border); padding: 1rem; margin-bottom: 0.5rem; cursor: pointer; border-radius: 5px; transition: border-color .3s; }
        .default-quest:hover { border-color: var(--p); }
    </style>
</head>
<body>
    <nav class="nav">
        <a href="daily-quests.html">Zurück zu den täglichen Quests</a>
    </nav>

    <header class="header">
        <h1 class="title">Erweiterter Quest-Editor</h1>
        <p class="subtitle">Gestalte deinen Weg zur Selbstverbesserung</p>
    </header>

    <section class="editor">
        <h2 style="margin-bottom: 1.5rem;">Quest erstellen oder bearbeiten</h2>
        <input type="hidden" id="questId">
        <div class="form-row">
            <label class="label">Quest-Name</label>
            <input type="text" class="input" id="questName" placeholder="z.B. Morgenlauf">
        </div>
        <div class="form-row">
            <label class="label">Beschreibung</label>
            <textarea class="textarea" id="questDesc" placeholder="Worum geht es bei dieser Quest?"></textarea>
        </div>
        <div class="form-row form-grid">
            <div>
                <label class="label">Ziel (was erreicht werden soll)</label>
                <input type="text" class="input" id="questTarget" placeholder="z.B. 30 Minuten, 20 Wiederholungen">
            </div>
            <div>
                <label class="label">Basis-XP-Belohnung</label>
                <input type="number" class="input" id="questXP" value="25" min="5">
            </div>
        </div>
        <div class="form-row form-grid">
            <div>
                <label class="label">Gewohnheitskette (optional)</label>
                <input type="text" class="input" id="questChain" placeholder="z.B. Fitness, Achtsamkeit">
            </div>
            <div>
                <label class="label">Freischalt-Level (optional)</label>
                <input type="number" class="input" id="questUnlock" placeholder="z.B. 5">
            </div>
        </div>
        <div class="form-row">
            <label class="label">
                <input type="checkbox" id="questScaling" style="margin-right: 0.5rem;">
                Skalierung aktivieren (steigt mit dem Level)
            </label>
        </div>
        <div class="form-row form-grid" id="scalingOptions" style="display: none;">
            <div>
                <label class="label">Basis-Betrag</label>
                <input type="number" class="input" id="questBaseAmount" value="15" min="1">
            </div>
            <div>
                <label class="label">Anstieg pro Level</label>
                <input type="number" class="input" id="questIncrement" value="3" min="1">
            </div>
        </div>
        <div class="form-row">
            <button class="btn primary" onclick="addOrUpdateQuest()">Quest speichern</button>
            <button class="btn" onclick="clearForm()" id="clearBtn">Leeren</button>
        </div>
    </section>

    <section class="quest-list">
        <h2 style="margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">Deine benutzerdefinierten Quests</h2>
        <div id="questList"></div>
    </section>

    <script>
        let customQuests = [];
        
        function load() {
            let saved = localStorage.getItem('bq-custom');
            if (saved) customQuests = JSON.parse(saved);
            updateList();
        }
        
        function save() {
            localStorage.setItem('bq-custom', JSON.stringify(customQuests));
        }
        
        function addOrUpdateQuest() {
            const questId = document.getElementById('questId').value;
            const quest = {
                id: questId ? parseInt(questId) : Date.now(),
                name: document.getElementById('questName').value.trim(),
                desc: document.getElementById('questDesc').value.trim(),
                target: document.getElementById('questTarget').value.trim(),
                xp: parseInt(document.getElementById('questXP').value) || 25,
                scaling: document.getElementById('questScaling').checked,
                baseAmount: parseInt(document.getElementById('questBaseAmount').value) || 15,
                increment: parseInt(document.getElementById('questIncrement').value) || 3,
                chain: document.getElementById('questChain').value.trim() || null,
                unlockLevel: parseInt(document.getElementById('questUnlock').value) || null
            };

            if (!quest.name || !quest.target) {
                alert('Bitte fülle den Quest-Namen und das Ziel aus');
                return;
            }

            if (questId) {
                const index = customQuests.findIndex(q => q.id === quest.id);
                if (index !== -1) customQuests[index] = quest;
            } else {
                customQuests.push(quest);
            }
            
            save();
            updateList();
            clearForm();
        }
        
        function deleteQuest(id) {
            if (confirm('Diese Quest dauerhaft löschen?')) {
                customQuests = customQuests.filter(q => q.id !== id);
                save();
                updateList();
            }
        }
        
        function editQuest(id) {
            const quest = customQuests.find(q => q.id === id);
            if (quest) {
                document.getElementById('questId').value = quest.id;
                document.getElementById('questName').value = quest.name;
                document.getElementById('questDesc').value = quest.desc;
                document.getElementById('questTarget').value = quest.target;
                document.getElementById('questXP').value = quest.xp;
                document.getElementById('questScaling').checked = quest.scaling || false;
                document.getElementById('questBaseAmount').value = quest.baseAmount || 15;
                document.getElementById('questIncrement').value = quest.increment || 3;
                document.getElementById('questChain').value = quest.chain || '';
                document.getElementById('questUnlock').value = quest.unlockLevel || '';
                toggleScalingOptions();
                document.querySelector('.btn.primary').textContent = 'Quest aktualisieren';
                document.getElementById('clearBtn').textContent = 'Abbrechen';
                window.scrollTo(0, 0);
            }
        }
        
        function clearForm() {
            document.getElementById('questId').value = '';
            document.getElementById('questName').value = '';
            document.getElementById('questDesc').value = '';
            document.getElementById('questTarget').value = '';
            document.getElementById('questXP').value = '25';
            document.getElementById('questScaling').checked = false;
            document.getElementById('questChain').value = '';
            document.getElementById('questUnlock').value = '';
            toggleScalingOptions();
            document.querySelector('.btn.primary').textContent = 'Quest hinzufügen';
            document.getElementById('clearBtn').textContent = 'Leeren';
        }
        
        function toggleScalingOptions() {
            document.getElementById('scalingOptions').style.display = document.getElementById('questScaling').checked ? 'grid' : 'none';
        }
        
        function updateList() {
            const list = document.getElementById('questList');
            if (customQuests.length === 0) {
                list.innerHTML = '<div class="empty">Noch keine benutzerdefinierten Quests. Erstelle eine oben!</div>';
                return;
            }
            
            list.innerHTML = customQuests.map(quest => `
                <div class="quest-item">
                    <div class="quest-item-header">
                        <span class="quest-name">${quest.name}</span>
                        <span class="quest-xp">+${quest.xp} XP</span>
                    </div>
                    <p class="quest-desc">${quest.desc}</p>
                    <div class="quest-meta">
                        <span><strong>Ziel:</strong> ${quest.target}</span>
                        ${quest.scaling ? `<span><strong>Skalierung:</strong> ${quest.baseAmount}+${quest.increment}/lvl</span>` : ''}
                        ${quest.chain ? `<span><strong>Kette:</strong> ${quest.chain}</span>` : ''}
                        ${quest.unlockLevel ? `<span><strong>Freischaltung bei:</strong> Lvl ${quest.unlockLevel}</span>` : ''}
                    </div>
                    <div class="quest-actions">
                        <button class="btn btn-small" onclick="editQuest(${quest.id})">Bearbeiten</button>
                        <button class="btn btn-small btn-danger" onclick="deleteQuest(${quest.id})">Löschen</button>
                    </div>
                </div>
            `).join('');
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            load();
            document.getElementById('questScaling').addEventListener('change', toggleScalingOptions);
            if (customQuests.length === 0) {
                customQuests.push(
                    { id: 1, name: 'Körperliches Training', desc: 'Tägliche körperliche Betätigung', target: 'Liegestütze', xp: 50, scaling: true, baseAmount: 15, increment: 3, chain: 'Fitness', unlockLevel: null },
                    { id: 2, name: 'Geistiger Fokus', desc: 'Lesen zur geistigen Weiterentwicklung', target: '20 Min Lesen', xp: 30, scaling: false, chain: 'Achtsamkeit', unlockLevel: null },
                    { id: 3, name: 'Fortgeschrittenes Workout', desc: 'Ein härteres Workout', target: '50 Kniebeugen', xp: 100, scaling: false, chain: 'Fitness', unlockLevel: 5 }
                );
                save();
                updateList();
            }
        });
    </script>
</body>
</html>