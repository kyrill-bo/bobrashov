<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalender - Daily Quest</title>
    <style>
        :root{--p:#66BB6A;--s:#FFD54F;--bg:#121212;--card:#1e1e1e;--txt:#fff;--border:#333}
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:var(--bg);color:var(--txt);font-family:Georgia,serif;padding:1rem;max-width:1000px;margin:0 auto;line-height:1.6}
        .h{text-align:center;margin-bottom:2rem}.t{font-size:2rem;margin-bottom:.5rem;color:var(--p)}.st{opacity:.8;font-style:italic}
        .n{text-align:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
        .n a{color:var(--txt);text-decoration:none;margin:0 .5rem;font-size:.9rem;opacity:.8;transition:all .3s}
        .n a:hover{color:var(--p);opacity:1}
        .grid{display:grid;grid-template-columns:1fr;gap:1.5rem;margin-bottom:2rem}
        .c{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:1.5rem}
        .ch{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
        .cn{background:transparent;border:1px solid var(--border);color:var(--txt);padding:.3rem .6rem;cursor:pointer;border-radius:4px}
        .cn:hover{background:var(--p);color:var(--card)}
        .cal{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
        .dh{text-align:center;font-weight:bold;padding:.5rem;font-size:.8rem;opacity:.7}
        .day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:4px;cursor:pointer;position:relative;font-size:.8rem;transition:all .3s}
        .day:hover{background:var(--border)}.day.other{opacity:.3}.day.today{background:var(--p);color:var(--card);font-weight:bold}
        .day.completed{background:#4CAF50;color:white}.day.partial{background:#FF9800;color:white}.day.missed{background:#f44336;color:white}
        .sg{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:1rem}
        .stat{text-align:center;padding:1rem;background:var(--bg);border-radius:8px}
        .sv{font-size:1.5rem;font-weight:bold;color:var(--p);margin-bottom:.3rem}
        .sl{font-size:.8rem;opacity:.8}
        .ct{font-size:1.2rem;margin-bottom:1rem;color:var(--p)}
        .weekly{display:flex;align-items:end;gap:.5rem;height:150px;padding:1rem 0}
        .wb{flex:1;background:var(--p);border-radius:4px 4px 0 0;min-height:10px;position:relative;transition:all .3s}
        .wb:hover{opacity:.8}
        .wl{position:absolute;bottom:-25px;left:50%;transform:translateX(-50%);font-size:.7rem;opacity:.7}
        .legend{display:flex;justify-content:center;gap:1rem;margin-top:1rem;flex-wrap:wrap}
        .li{display:flex;align-items:center;gap:.5rem;font-size:.8rem}
        .lc{width:12px;height:12px;border-radius:3px}
        .insights{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:1.5rem}
        .insight{margin-bottom:1rem;padding:1rem;background:var(--bg);border-radius:8px}
        .it{font-weight:bold;margin-bottom:.5rem;color:var(--p)}
        .ix{font-size:.9rem;opacity:.8}
        .tooltip{position:absolute;background:rgba(0,0,0,.8);color:white;padding:.5rem;border-radius:4px;font-size:.7rem;pointer-events:none;z-index:1000;opacity:0;transition:opacity .3s}
    </style>
</head>
<body>
    <nav class="n">
        <a href="daily-quests.html">Quests</a>
        <a href="achievements.html">Erfolge</a>
        <a href="analytics.html">Statistiken</a>
        <a href="quest-shop.html">Shop</a>
        <a href="settings.html">Einstellungen</a>
    </nav>
    <header class="h">
        <h1 class="t">Kalender & Statistiken</h1>
        <p class="st">Deine Reise visualisiert</p>
    </header>
    <div class="grid">
        <div class="c">
            <div class="ch">
                <button class="cn" id="pm">â€¹</button>
                <h3 id="cm">Januar 2025</h3>
                <button class="cn" id="nm">â€º</button>
            </div>
            <div class="cal" id="cal"></div>
            <div class="legend">
                <div class="li"><div class="lc" style="background:#4CAF50"></div><span>Perfekt</span></div>
                <div class="li"><div class="lc" style="background:#FF9800"></div><span>Teilweise</span></div>
                <div class="li"><div class="lc" style="background:#f44336"></div><span>Verpasst</span></div>
            </div>
        </div>
        <div class="c">
            <h3 class="ct">ðŸ“Š Dieser Monat</h3>
            <div class="sg">
                <div class="stat"><div class="sv" id="pd">0</div><div class="sl">Perfekte Tage</div></div>
                <div class="stat"><div class="sv" id="tx">0</div><div class="sl">Gesamt-XP</div></div>
                <div class="stat"><div class="sv" id="ax">0</div><div class="sl">Durchschn.-XP/Tag</div></div>
                <div class="stat"><div class="sv" id="cr">0%</div><div class="sl">Abschlussrate</div></div>
            </div>
        </div>
        <div class="c">
            <h3 class="ct">ðŸ“ˆ WÃ¶chentlicher Fortschritt</h3>
            <div class="weekly" id="wc"></div>
        </div>
        <div class="insights">
            <h3 class="ct">ðŸ’¡ Einblicke</h3>
            <div id="il"></div>
        </div>
    </div>
    <div class="tooltip" id="tp"></div>
    <script>
        let cd=new Date(),dd={};
        function ld(){
            const ch=JSON.parse(localStorage.getItem('completionHistory')||'[]'),dp=JSON.parse(localStorage.getItem('dailyProgress')||'{}');
            dd={};
            Object.entries(dp).forEach(([d,data])=>{
                const dob=new Date(d),k=dob.toISOString().split('T')[0];
                dd[k]={date:dob,questsCompleted:data.questsCompleted||0,totalQuests:data.totalQuests||3,xpEarned:data.xpEarned||0,perfectDay:data.questsCompleted>=data.totalQuests};
            });
        }
        function gc(){
            const c=document.getElementById('cal'),mh=document.getElementById('cm');
            c.innerHTML='';
            const y=cd.getFullYear(),m=cd.getMonth();
            mh.textContent=cd.toLocaleDateString('de-DE',{month:'long',year:'numeric'});
            const dhs=['S','M','D','M','D','F','S'];
            dhs.forEach(d=>{const de=document.createElement('div');de.className='dh';de.textContent=d;c.appendChild(de);});
            const fd=new Date(y,m,1),ld=new Date(y,m+1,0),dim=ld.getDate(),sdow=fd.getDay();
            const pm=new Date(y,m,0);
            for(let i=sdow;i>0;i--){c.appendChild(cde(pm.getDate()-i+1,true,new Date(y,m-1,pm.getDate()-i+1)));}
            for(let d=1;d<=dim;d++){c.appendChild(cde(d,false,new Date(y,m,d)));}
            const rc=42-(sdow+dim);
            for(let d=1;d<=rc;d++){c.appendChild(cde(d,true,new Date(y,m+1,d)));}
        }
        function cde(d,iom,dt){
            const de=document.createElement('div');
            de.className='day';de.textContent=d;
            if(iom)de.classList.add('other');
            const td=new Date();
            if(dt.toDateString()===td.toDateString())de.classList.add('today');
            const k=dt.toISOString().split('T')[0],data=dd[k];
            if(data){
                if(data.perfectDay)de.classList.add('completed');
                else if(data.questsCompleted>0)de.classList.add('partial');
                else de.classList.add('missed');
                de.addEventListener('mouseenter',e=>st(e,data));de.addEventListener('mouseleave',ht);
            }
            return de;
        }
        function st(e,d){
            const t=document.getElementById('tp'),cr=Math.round((d.questsCompleted/d.totalQuests)*100);
            t.innerHTML=`<strong>${d.date.toLocaleDateString('de-DE')}</strong><br>Quests: ${d.questsCompleted}/${d.totalQuests}<br>XP: ${d.xpEarned||0}<br>Rate: ${cr}%`;
            t.style.left=e.pageX+10+'px';t.style.top=e.pageY-50+'px';t.style.opacity='1';
        }
        function ht(){document.getElementById('tp').style.opacity='0';}
        function us(){
            const cm=cd.getMonth(),cy=cd.getFullYear();
            let pd=0,tx=0,td=0,cq=0,tq=0;
            Object.values(dd).forEach(d=>{
                if(d.date.getMonth()===cm&&d.date.getFullYear()===cy){
                    td++;if(d.perfectDay)pd++;tx+=d.xpEarned||0;cq+=d.questsCompleted;tq+=d.totalQuests;
                }
            });
            const ax=td>0?Math.round(tx/td):0,cr=tq>0?Math.round((cq/tq)*100):0;
            document.getElementById('pd').textContent=pd;document.getElementById('tx').textContent=tx;
            document.getElementById('ax').textContent=ax;document.getElementById('cr').textContent=cr+'%';
        }
        function gwc(){
            const c=document.getElementById('wc');c.innerHTML='';
            const ws=[],td=new Date();
            for(let i=7;i>=0;i--){
                const wst=new Date(td);wst.setDate(td.getDate()-(i*7)-td.getDay());
                const wen=new Date(wst);wen.setDate(wst.getDate()+6);
                let wx=0;
                Object.values(dd).forEach(d=>{if(d.date>=wst&&d.date<=wen)wx+=d.xpEarned||0;});
                ws.push({xp:wx,label:wst.toLocaleDateString('de-DE',{month:'short',day:'numeric'})});
            }
            const mx=Math.max(...ws.map(w=>w.xp),100);
            ws.forEach(w=>{
                const b=document.createElement('div');b.className='wb';b.style.height=((w.xp/mx)*100)+'%';
                const l=document.createElement('div');l.className='wl';l.textContent=w.label;b.appendChild(l);
                c.appendChild(b);
            });
        }
        function gi(){
            const ins=document.getElementById('il');ins.innerHTML='';
            const id=ad();id.forEach(i=>{
                const it=document.createElement('div');it.className='insight';
                it.innerHTML=`<div class="it">${i.title}</div><div class="ix">${i.text}</div>`;ins.appendChild(it);
            });
        }
        function ad(){
            const ad=Object.values(dd);
            if(ad.length===0)return[{title:"ðŸŒ± Leg los",text:"SchlieÃŸe deine ersten Quests ab, um Einblicke zu erhalten."}];
            const ds={};
            ad.forEach(d=>{const day=d.date.getDay();if(!ds[day])ds[day]={perfect:0,total:0};ds[day].total++;if(d.perfectDay)ds[day].perfect++;});
            let bd=0,br=0;
            Object.entries(ds).forEach(([d,s])=>{const r=s.perfect/s.total;if(r>br){br=r;bd=parseInt(d);}});
            const dns=['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'];
            return[{title:"ðŸ“ˆ Bester Tag",text:`Du bist am ${dns[bd]} am leistungsfÃ¤higsten mit einer Abschlussrate von ${Math.round(br*100)}%.`},{title:"ðŸ“Š Fortschritt",text:"Bleib dran, um bessere Einblicke zu erhalten."}];
        }
        document.getElementById('pm').addEventListener('click',()=>{cd.setMonth(cd.getMonth()-1);gc();us();});
        document.getElementById('nm').addEventListener('click',()=>{cd.setMonth(cd.getMonth()+1);gc();us();});
        function init(){ld();gc();us();gwc();gi();}
        init();setInterval(init,60000);
    </script>
</body>
</html>