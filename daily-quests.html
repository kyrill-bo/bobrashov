<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Quests - Bobrashov</title>
    <style>
        :root{--p:#666;--s:#999;--bg:#000;--card:#111;--txt:#fff;--border:#333}
        [data-theme="light"]{--p:#4CAF50;--s:#FFC107;--bg:#f5f5f5;--card:#fff;--txt:#333;--border:#ddd}
        [data-theme="dark"]{--p:#66BB6A;--s:#FFD54F;--bg:#121212;--card:#1e1e1e;--txt:#fff;--border:#333}
        [data-theme="minimal"]{--p:#000;--s:#666;--bg:#fff;--card:#fafafa;--txt:#000;--border:#eee}
        [data-theme="ocean"]{--p:#2196F3;--s:#00BCD4;--bg:#E3F2FD;--card:#fff;--txt:#0D47A1;--border:#BBDEFB}
        [data-theme="forest"]{--p:#388E3C;--s:#8BC34A;--bg:#E8F5E8;--card:#fff;--txt:#1B5E20;--border:#C8E6C9}
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:var(--bg);color:var(--txt);font-family:Georgia,serif;padding:2rem;max-width:700px;margin:0 auto;line-height:1.6;transition:all .3s}
        .h{text-align:center;margin-bottom:3rem}.t{font-size:2.5rem;margin-bottom:.5rem;color:var(--p)}.st{opacity:.8;font-style:italic}
        .stats{display:flex;justify-content:space-between;margin-bottom:3rem}.stat{text-align:center}.sv{font-size:2rem;margin-bottom:.3rem;color:var(--p)}.sl{opacity:.8;font-size:.9rem}
        .prog{margin-bottom:3rem}.pi{display:flex;justify-content:space-between;margin-bottom:.5rem}
        .pb{width:100%;height:15px;background:var(--card);border:1px solid var(--border);border-radius:8px;overflow:hidden}
        .pf{height:100%;background:var(--p);width:0%;transition:width .3s}
        .q{background:var(--card);border:1px solid var(--border);padding:1.5rem;margin-bottom:1rem;border-radius:10px;transition:all .3s}
        .q.done{opacity:.6}.qh{display:flex;justify-content:space-between;margin-bottom:1rem}.qt{font-size:1.2rem}
        .qx{background:var(--s);color:var(--card);padding:.2rem .6rem;font-size:.8rem;border-radius:12px;font-weight:bold}
        .qg{text-align:center;font-size:1.5rem;margin:1rem 0}
        .btn{background:transparent;border:1px solid var(--border);color:var(--txt);padding:.6rem 1rem;cursor:pointer;font-family:inherit;border-radius:6px;transition:all .3s}
        .btn:hover{background:var(--p);color:var(--card)}.btn:disabled{opacity:.5;cursor:not-allowed}
        .r{text-align:center;margin-top:2rem;padding-top:2rem;border-top:1px solid var(--border)}
        .rb{background:transparent;border:1px solid var(--border);color:var(--txt);padding:.4rem .8rem;cursor:pointer;font-family:inherit;font-size:.8rem;border-radius:6px;opacity:.7;transition:all .3s}
        .rb:hover{opacity:1;background:var(--border)}
        .c{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--card);border:2px solid var(--p);padding:2rem;text-align:center;opacity:0;transition:opacity .3s;border-radius:15px;box-shadow:0 8px 32px rgba(0,0,0,.3)}
        .c.show{opacity:1}
        .n{text-align:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
        .n a{color:var(--txt);text-decoration:none;margin:0 1rem;font-size:.9rem;opacity:.8;transition:all .3s}
        .n a:hover{color:var(--p);opacity:1}
        .sb{border-radius:10px;animation:pulse 2s infinite;text-align:center;margin-bottom:2rem;padding:1rem;background:var(--card);border:1px solid var(--border);display:none}
        @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,193,7,.4)}70%{box-shadow:0 0 0 10px rgba(255,193,7,0)}100%{box-shadow:0 0 0 0 rgba(255,193,7,0)}}
        @media(max-width:600px){body{padding:1rem}.stats{flex-wrap:wrap;gap:1rem}.t{font-size:2rem}}
    </style>
</head>
<body>
    <nav class="n">
        <a href="achievements.html">üèÜ Achievements</a>
        <a href="calendar.html">üìÖ Calendar</a>
        <a href="analytics.html">üìä Analytics</a>
        <a href="quest-editor.html">Quest Editor</a>
        <a href="quest-shop.html">üõí Shop</a>
        <a href="settings.html">‚öôÔ∏è Settings</a>
        <a href="index.html">Home</a>
    </nav>
    <header class="h">
        <h1 class="t">Daily Quests</h1>
        <p class="st">Level up through discipline</p>
    </header>
    <section class="stats">
        <div class="stat"><div class="sv" id="lv">1</div><div class="sl">Level</div></div>
        <div class="stat"><div class="sv" id="xp">0</div><div class="sl">Total XP</div></div>
        <div class="stat"><div class="sv" id="st">0</div><div class="sl">Streak</div></div>
        <div class="stat"><div class="sv" id="m">1.0x</div><div class="sl">XP Multiplier</div></div>
    </section>
    <div class="sb" id="sb">
        <div class="bt">üî• Streak Bonus Active!</div>
        <div class="bd" id="bd"></div>
    </div>
    <section class="prog">
        <div class="pi">
            <span>Level <span id="clv">1</span></span>
            <span><span id="cur">0</span>/<span id="need">100</span> XP</span>
        </div>
        <div class="pb"><div class="pf" id="bar"></div></div>
    </section>
    <section id="q"></section>
    <div class="r"><button class="rb" onclick="reset()">Reset Progress</button></div>
    <div class="c" id="cel">
        <h2>Level Up!</h2>
        <p>Level <span id="nlv"></span> Achieved</p>
        <button class="btn" onclick="hide()">Continue</button>
    </div>
    <script>
        let s={lv:1,xp:0,cur:0,need:100,streak:0,done:[],last:null,pf:0,tx:0},q=[];
        function gm(st){return st>=30?2:st>=14?1.5:st>=7?1.25:1;}
        function gb(p){return p>=4?2500:p>=2?1000:p>=1?500:0;}
        function us(){
            const m=gm(s.streak),sb=document.getElementById('sb'),ms=document.getElementById('m'),bd=document.getElementById('bd');
            ms.textContent=m.toFixed(1)+'x';
            if(m>1){
                sb.style.display='block';
                let t='';
                if(s.streak>=30)t=`üöÄ Legendary Streak! ${s.streak} days - Double XP!`;
                else if(s.streak>=14)t=`üí™ Strong Streak! ${s.streak} days - 50% Bonus XP!`;
                else if(s.streak>=7)t=`üî• Week Streak! ${s.streak} days - 25% Bonus XP!`;
                const wb=gb(s.pf);
                if(wb>0)t+=`<br>üíé Perfect Week Bonus: +${wb} XP earned!`;
                bd.innerHTML=t;
            }else sb.style.display='none';
        }
        function tr(){
            const n=new Date();
            let h=JSON.parse(localStorage.getItem('completionHistory')||'[]');
            h.push({timestamp:n.toISOString(),hour:n.getHours(),isWeekend:n.getDay()===0||n.getDay()===6});
            localStorage.setItem('completionHistory',JSON.stringify(h));
            const td=n.toDateString();
            let dp=JSON.parse(localStorage.getItem('dailyProgress')||'{}');
            if(!dp[td])dp[td]={questsCompleted:0,totalQuests:q.length,xpEarned:0};
            dp[td].questsCompleted++;dp[td].xpEarned=dp[td].xpEarned||0;
            localStorage.setItem('dailyProgress',JSON.stringify(dp));
        }
        function lq(){
            let c=localStorage.getItem('bq-custom');
            if(!c){
                let df=[
                    {name:'Physical Training',target:'Push-ups',xp:50,desc:'Daily physical exercise',scaling:true,baseAmount:15,increment:3},
                    {name:'Mental Focus',target:'Min Reading',xp:30,desc:'Reading for mental growth',scaling:false},
                    {name:'Inner Peace',target:'Min Meditation',xp:25,desc:'Mindfulness practice',scaling:false}
                ];
                localStorage.setItem('bq-custom',JSON.stringify(df));c=JSON.stringify(df);
            }
            let cq=JSON.parse(c);
            q=cq.map(i=>({name:i.name,target:i.target,baseTarget:i.scaling?i.baseAmount||15:(i.name==='Mental Focus'?20:10),xp:i.xp,desc:i.desc,scaling:i.scaling||false,increment:i.increment||3}));
            s.done=new Array(q.length).fill(0);
        }
        function ld(){
            let sv=localStorage.getItem('bq');
            if(sv){
                s={...s,...JSON.parse(sv)};
                let td=new Date().toDateString();
                if(s.last!==td){
                    s.done=new Array(q.length).fill(0);
                    if(s.last&&(new Date(td)-new Date(s.last))/86400000>1){
                        const dd=Math.floor((new Date(td)-new Date(s.last))/86400000);
                        if(dd>=7){
                            let cb=parseInt(localStorage.getItem('comebacks')||'0');
                            localStorage.setItem('comebacks',(cb+1).toString());
                        }
                        s.streak=0;s.pf=0;
                    }
                }
            }
        }
        function sv(){
            localStorage.setItem('bq',JSON.stringify(s));
            let ud=JSON.parse(localStorage.getItem('userData')||'{}');
            ud.level=s.lv;ud.totalXP=s.xp;ud.streak=s.streak;
            localStorage.setItem('userData',JSON.stringify(ud));
        }
        function rn(){
            let h='';const m=gm(s.streak);
            q.forEach((i,x)=>{
                let tg,xp;
                if(i.scaling){
                    let amt=i.baseTarget+Math.floor((s.lv-1)*i.increment);
                    tg=amt+' '+i.target;xp=i.xp+(s.lv-1)*5;
                }else{tg=i.baseTarget+' '+i.target;xp=i.xp;}
                const fx=Math.round(xp*m),bx=fx-xp;let dn=s.done[x];
                h+=`<div class="q ${dn?'done':''}" id="q${x+1}">
                    <div class="qh">
                        <h3 class="qt">${i.name}</h3>
                        <span class="qx">+${fx} XP${bx>0?` <small style="color:#ffc107;">(+${bx} bonus)</small>`:''}</span>
                    </div>
                    <div class="qg">${tg}</div>
                    <button class="btn" onclick="co(${x})" ${dn?'disabled':''}>${dn?'Done ‚úì':'Complete'}</button>
                </div>`;
            });
            document.getElementById('q').innerHTML=h;
        }
        function up(){
            document.getElementById('lv').textContent=s.lv;document.getElementById('xp').textContent=s.xp;
            document.getElementById('st').textContent=s.streak;document.getElementById('clv').textContent=s.lv;
            document.getElementById('cur').textContent=s.cur;document.getElementById('need').textContent=s.need;
            document.getElementById('bar').style.width=(s.cur/s.need*100)+'%';
            us();rn();
        }
        function co(i){
            if(s.done[i])return;
            let bx;
            if(q[i].scaling)bx=q[i].xp+(s.lv-1)*5;else bx=q[i].xp;
            const m=gm(s.streak),fx=Math.round(bx*m);
            s.done[i]=1;s.xp+=fx;s.cur+=fx;s.last=new Date().toDateString();
            const td=new Date().toDateString();
            let dp=JSON.parse(localStorage.getItem('dailyProgress')||'{}');
            if(!dp[td])dp[td]={questsCompleted:0,totalQuests:q.length,xpEarned:0};
            dp[td].xpEarned=(dp[td].xpEarned||0)+fx;
            localStorage.setItem('dailyProgress',JSON.stringify(dp));
            tr();ps();
            sn(`üéØ Quest Completed!`,`${q[i].name} - +${fx} XP earned${m>1?` (${m}x bonus!)`:''}`);
            if(s.cur>=s.need){
                s.cur-=s.need;s.lv++;s.need=Math.floor(100*Math.pow(1.2,s.lv-1));
                document.getElementById('nlv').textContent=s.lv;
                document.getElementById('cel').classList.add('show');
                sn(`üéâ Level Up!`,`Congratulations! You reached Level ${s.lv}!`);
            }
            if(s.done.every(x=>x)){
                s.streak++;
                sn(`‚≠ê Perfect Day!`,`All quests completed! Streak: ${s.streak} days`);
                if(s.streak%7===0){
                    s.pf=Math.floor(s.streak/7);
                    const wb=gb(s.pf);
                    if(wb>0){
                        s.xp+=wb;s.cur+=wb;s.tx+=wb;
                        setTimeout(()=>{
                            sn(`üéâ Perfect Week Bonus!`,`+${wb} XP - You've completed ${s.pf} perfect week(s)!`);
                        },1000);
                    }
                }
            }
            sv();up();
            if(typeof window.checkAchievements==='function')window.checkAchievements();
        }
        function hide(){document.getElementById('cel').classList.remove('show');}
        function reset(){if(confirm('Reset all progress?')){localStorage.removeItem('bq');s={lv:1,xp:0,cur:0,need:100,streak:0,done:new Array(q.length).fill(0),last:null,pf:0,tx:0};up();}}
        function rq(){if('Notification'in window&&Notification.permission==='default')Notification.requestPermission();}
        function at(){const st=JSON.parse(localStorage.getItem('questSettings')||'{}');if(st.theme)document.documentElement.setAttribute('data-theme',st.theme);}
        function ps(){
            const st=JSON.parse(localStorage.getItem('questSettings')||'{}');
            if(!st.celebrationSounds)return;
            try{
                const ctx=new(window.AudioContext||window.webkitAudioContext)(),osc=ctx.createOscillator(),gain=ctx.createGain();
                osc.connect(gain);gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(800,ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200,ctx.currentTime+0.1);
                gain.gain.setValueAtTime(0.3,ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.3);
                osc.start(ctx.currentTime);osc.stop(ctx.currentTime+0.3);
            }catch(e){}
        }
        function sn(t,b,o={}){
            const st=JSON.parse(localStorage.getItem('questSettings')||'{}');
            if(!st.achievementNotifications)return;
            if('Notification'in window&&Notification.permission==='granted'){
                const n=new Notification(t,{body:b,icon:'/favicon.ico',badge:'/favicon.ico',...o});
                n.onclick=()=>{window.focus();n.close();};
                setTimeout(()=>n.close(),5000);
            }
        }
        at();lq();ld();up();rq();
    </script>
</body>
</html>